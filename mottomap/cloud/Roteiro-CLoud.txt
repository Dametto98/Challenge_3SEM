### üõ†Ô∏è **Etapa 1: Build com Maven**

```dockerfile
FROM maven:3.9.6-eclipse-temurin-17-alpine AS build
WORKDIR /build
COPY MottoMap-JavaBackend/ ./MottoMap-JavaBackend/
WORKDIR /build/MottoMap-JavaBackend
```

**Explica√ß√£o:**

* ‚ÄúCome√ßamos usando uma imagem do Maven com Java 17 para compilar o projeto.‚Äù
* ‚Äú`WORKDIR /build` define a pasta onde os arquivos ser√£o copiados e o build ser√° feito.‚Äù
* ‚ÄúDepois copiamos o c√≥digo-fonte do projeto para dentro da imagem Docker.‚Äù
* ‚ÄúEm seguida, mudamos para o diret√≥rio do projeto para poder executar os comandos do Maven.‚Äù

---

### üöÄ **Etapa 2: Criar imagem final leve**

```dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
```

**Explica√ß√£o:**

* ‚ÄúAqui come√ßa a segunda etapa: usamos uma imagem menor, com apenas o Java Runtime (JRE), sem o Maven.‚Äù
* ‚ÄúIsso reduz muito o tamanho da imagem final, ideal para produ√ß√£o.‚Äù

---

### üì¶ **Copiar o JAR do build**

```dockerfile
COPY --from=build /build/MottoMap-JavaBackend/target/*.jar app.jar
```

**Explica√ß√£o:**

* ‚ÄúUsamos o `COPY --from=build` para pegar o arquivo `.jar` que foi gerado na etapa anterior e traz√™-lo para essa imagem final.‚Äù

---

### üë§ **Seguran√ßa: usu√°rio sem privil√©gios**

```dockerfile
RUN addgroup --system appgroup && adduser --system --ingroup appgroup appuser
USER appuser
```

**Explica√ß√£o:**

* ‚ÄúPor padr√£o, containers rodam como root, o que √© perigoso.‚Äù
* ‚ÄúAqui criamos um usu√°rio comum chamado `appuser`, e configuramos o container para rodar com esse usu√°rio. Isso √© uma boa pr√°tica de seguran√ßa.‚Äù

---

### üåê **Porta e comando de execu√ß√£o**

```dockerfile
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**Explica√ß√£o:**

* ‚ÄúCom `EXPOSE 8080`, estamos dizendo que o container vai escutar na porta 8080 ‚Äî √∫til para o mapeamento de portas.‚Äù
* ‚ÄúE o `ENTRYPOINT` define o comando que ser√° executado quando o container iniciar: ele vai rodar a aplica√ß√£o com Java.‚Äù

---

### ‚úÖ **Resumo final**

> ‚ÄúCom esse Dockerfile, conseguimos compilar uma aplica√ß√£o Java usando Maven em uma imagem separada, e depois rod√°-la em uma imagem mais leve e segura, pronta para produ√ß√£o.‚Äù

---

Se quiser, posso montar um **roteiro narrado completo** ou at√© te ajudar com os slides ou imagens para o v√≠deo. Deseja isso?

----------------------------------------Configurando o projeto JAVA

--Dentro da pasta do projeto cloud(Fazer pelo VSCODE)

git clone https://github.com/GuiJanunzzi/MottoMap-JavaBackend.git

-----------------------------------------DOCKER FILE

----Dentro da pasta do projeto cloud(Fazer pelo VSCODE)

--ARQUIVO Dockerfile
FROM maven:3.9.6-eclipse-temurin-17-alpine AS build
WORKDIR /build

COPY MottoMap-JavaBackend/ ./MottoMap-JavaBackend/
WORKDIR /build/MottoMap-JavaBackend
 
RUN mvn clean package -DskipTests

FROM eclipse-temurin:17-jre-alpine
WORKDIR /app

COPY --from=build /build/MottoMap-JavaBackend/target/*.jar app.jar

RUN addgroup --system appgroup && adduser --system --ingroup appgroup appuser
 
USER appuser
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]

--TERMINAL VsCode

docker build -t mottomap_backend:1.0 .

docker run -d -p 8080:8080  mottomap_backend:1.0

docker ps

-----------TESTE DOCKER LOCAL

SWAGGER
http://host.docker.internal:8080/swagger-ui/index.html

INSOMNIA
host.docker.internal:8080

//Comandos para subir a imagem para o DockerHub

docker tag mottomap_backend:1.0 guijanunzzi/mottomap_backend:1.0

docker images

docker push guijanunzzi/mottomap_backend:1.0

--------------------------------------------AZURE CLI

--Criando o Resource Group
az group create -l eastus -n rg-mottomap

--Crinado a VM
az vm create --resource-group rg-mottomap --name vm-linux-mottomap --image Canonical:ubuntu-24_04-lts:minimal:24.04.202505020 --size Standard_B2s --admin-username admin_fiap --admin-password admin_fiap@123

-- Liberando a Porta 8080
az network nsg rule create --resource-group rg-mottomap --nsg-name vm-linux-mottomapNSG --name port_8080 --protocol tcp --priority 1010 --destination-port-range 8080

-- Liberando a Porta 80
az network nsg rule create --resource-group rg-mottomap --nsg-name vm-linux-mottomapNSG --name port_80 --protocol tcp --priority 1020 --destination-port-range 80

--Instalar o docker na VM
Link Instala√ß√£o: 
https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository

--Rodar o container
sudo docker run -d -p 8080:8080  guijanunzzi/mottomap_backend:1.0

--Verificar ativos
sudo docker ps

--DENTRO DA VM


------------TESTE VM IP
--SWAGGER
----IP p√∫blico da Maquina----:8080/swagger-ui/index.html

--INSOMINIA
----IP p√∫blico da Maquina----:8080/filial

========================================
1. CONFIGURANDO O PROJETO JAVA
========================================

Dentro da pasta do projeto cloud (usar o VS Code):

Clonar o reposit√≥rio:
git clone https://github.com/GuiJanunzzi/MottoMap-JavaBackend.git

========================================
2. CRIANDO O DOCKERFILE
========================================

Criar um arquivo chamado 'Dockerfile' na raiz do projeto:

Conte√∫do do Dockerfile:
-----------------------------
FROM maven:3.9.6-eclipse-temurin-17-alpine AS build
WORKDIR /build

COPY MottoMap-JavaBackend/ ./MottoMap-JavaBackend/
WORKDIR /build/MottoMap-JavaBackend
 
RUN mvn clean package -DskipTests

FROM eclipse-temurin:17-jre-alpine
WORKDIR /app

COPY --from=build /build/MottoMap-JavaBackend/target/*.jar app.jar

RUN addgroup --system appgroup && adduser --system --ingroup appgroup appuser
 
USER appuser
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
-----------------------------


========================================
3. CONSTRUIR E EXECUTAR O CONTAINER LOCALMENTE
========================================

No terminal (dentro do projeto):
docker build -t mottomap_backend:1.0 .
docker run -d -p 8080:8080 mottomap_backend:1.0
docker ps

========================================
4. TESTE DOCKER LOCAL
========================================

Swagger:
http://host.docker.internal:8080/swagger-ui/index.html

Insomnia:
host.docker.internal:8080

========================================
5. PUBLICAR IMAGEM NO DOCKER HUB
========================================

docker tag mottomap_backend:1.0 guijanunzzi/mottomap_backend:1.0
docker push guijanunzzi/mottomap_backend:1.0

========================================
6. CONFIGURA√á√ÉO AZURE CLI
========================================

Criar Resource Group:
az group create -l eastus -n rg-mottomap

Criar M√°quina Virtual:
az vm create --resource-group rg-mottomap --name vm-linux-mottomap --image Canonical:ubuntu-24_04-lts:minimal:24.04.202505020 --size Standard_B2s --admin-username admin_fiap --admin-password admin_fiap@123

Liberar a porta 8080:
az network nsg rule create --resource-group rg-mottomap --nsg-name vm-linux-mottomapNSG --name port_8080 --protocol tcp --priority 1010 --destination-port-range 8080

Liberar a porta 80:
az network nsg rule create --resource-group rg-mottomap --nsg-name vm-linux-mottomapNSG --name port_80 --protocol tcp --priority 1020 --destination-port-range 80


========================================
7. CONFIGURA√á√ÉO NA VM (UBUNTU)
========================================

Instalar o Docker na VM (seguir documenta√ß√£o oficial):
https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository

Executar o container na VM:
docker run -d -p 8080:8080 guijanunzzi/mottomap_backend:1.0


========================================
8. TESTE NA VM (AZURE)
========================================

Swagger:
http://<IP_P√∫blico_VM>:8080/swagger-ui/index.html

Insomnia:
<IP_P√∫blico_VM>:8080/filial
